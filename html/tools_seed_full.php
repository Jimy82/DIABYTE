<?php
declare(strict_types=1);

$pdo = new PDO('mysql:host=db;port=3306;dbname=diabyte;charset=utf8mb4','diabyte','abc123.',[
  PDO::ATTR_ERRMODE=>PDO::ERRMODE_EXCEPTION,
  PDO::ATTR_DEFAULT_FETCH_MODE=>PDO::FETCH_ASSOC,
]);

$pdo->exec("CREATE TABLE IF NOT EXISTS foods(
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(190) NOT NULL,
  carbs_per_100g DECIMAL(6,2) NOT NULL DEFAULT 0,
  glycemic_index INT NULL,
  unit VARCHAR(10) NOT NULL DEFAULT 'g',
  UNIQUE KEY uniq_food_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4");

$foods = [
  ['Lacteos','Cuajada',200,35],
  ['Lacteos','Flan',50,10],
  ['Lacteos','Helado de crema',50,60],
  ['Lacteos','Helado de hielo',50,64],
  ['Lacteos','Helado sin azúcar',100,35],
  ['Lacteos','Kefir',200,35],
  ['Lacteos','Leche desnatada',200,32],
  ['Lacteos','Leche semidesnatada',200,30],
  ['Lacteos','Leche entera',200,27],
  ['Lacteos','Leche condensada',20,61],
  ['Lacteos','Leche en polvo',25,30],
  ['Lacteos','Nata liquida',300,15],
  ['Lacteos','Natillas',50,10],
  ['Lacteos','Petit suisse',70,40],
  ['Lacteos','Queso fresco',250,35],
  ['Lacteos','Yogur natural',200,35],
  ['Lacteos','Yogur desnatado sabores',125,35],
  ['Lacteos','Yogur liquido',70,35],
  ['Lacteos','Yogur Actimel',100,35],

  ['Cereales, Harinas y Legumbres','Arroz cocido',38,70],
  ['Cereales, Harinas y Legumbres','Arroz integral cocido',40,50],
  ['Cereales, Harinas y Legumbres','Arroz hinchado',12,85],
  ['Cereales, Harinas y Legumbres','Avena cocida',34,40],
  ['Cereales, Harinas y Legumbres','Avena copos',15,40],
  ['Cereales, Harinas y Legumbres','Boniato',50,50],
  ['Cereales, Harinas y Legumbres','Cebada cocida',42,45],
  ['Cereales, Harinas y Legumbres','Cereales desayuno',15,77],
  ['Cereales, Harinas y Legumbres','Cereales All-bram',20,50],
  ['Cereales, Harinas y Legumbres','Cuscus cocido',65,65],
  ['Cereales, Harinas y Legumbres','Fideo de arroz',50,50],
  ['Cereales, Harinas y Legumbres','Fideos de soja',40,10],
  ['Cereales, Harinas y Legumbres','Galleta Digestiva',16,65],
  ['Cereales, Harinas y Legumbres','Galleta Maria',15,70],
  ['Cereales, Harinas y Legumbres','Galleta Principe',14,70],
  ['Cereales, Harinas y Legumbres','Galleta sin azúcar',18,50],
  ['Cereales, Harinas y Legumbres','Garbanzo cocido',50,35],
  ['Cereales, Harinas y Legumbres','Guisantes',100,35],
  ['Cereales, Harinas y Legumbres','Harina',15,78],
  ['Cereales, Harinas y Legumbres','Harina de centeno',17,45],
  ['Cereales, Harinas y Legumbres','Harina de soja',70,25],
  ['Cereales, Harinas y Legumbres','Hojaldre horneado',24,10],
  ['Cereales, Harinas y Legumbres','Judias blancas',50,35],
  ['Cereales, Harinas y Legumbres','Lentejas',50,35],
  ['Cereales, Harinas y Legumbres','Maiz en lata',50,65],
  ['Cereales, Harinas y Legumbres','Muesli',15,65],
  ['Cereales, Harinas y Legumbres','Pan blanco',20,70],
  ['Cereales, Harinas y Legumbres','Pan de centeno',20,65],
  ['Cereales, Harinas y Legumbres','Pan de molde',20,85],
  ['Cereales, Harinas y Legumbres','Pan de hamburguesa',18,85],
  ['Cereales, Harinas y Legumbres','Pan integral',23,40],
  ['Cereales, Harinas y Legumbres','Pan rallado',15,70],
  ['Cereales, Harinas y Legumbres','Pan tostado',15,70],
  ['Cereales, Harinas y Legumbres','Pan bastoncitos',15,70],
  ['Cereales, Harinas y Legumbres','Pasta',50,50],
  ['Cereales, Harinas y Legumbres','Patata cocida',50,65],
  ['Cereales, Harinas y Legumbres','Patata horno',35,60],
  ['Cereales, Harinas y Legumbres','Patata frita',30,70],
  ['Cereales, Harinas y Legumbres','Patatas chips',20,95],
  ['Cereales, Harinas y Legumbres','Pure de patatas',80,90],
  ['Cereales, Harinas y Legumbres','Quinoa',48,35],
  ['Cereales, Harinas y Legumbres','Semola de trigo',90,67],
  ['Cereales, Harinas y Legumbres','Soja hervida',100,15],
  ['Cereales, Harinas y Legumbres','Sushi',45,42],
  ['Cereales, Harinas y Legumbres','Tapioca',33,84],
  ['Cereales, Harinas y Legumbres','Trigo sarraceno',42,40],
  ['Cereales, Harinas y Legumbres','Yuca',33,55],

  ['Frutas','Albaricoque',150,30],
  ['Frutas','Arandano',100,25],
  ['Frutas','Castana cruda',30,65],
  ['Frutas','Castana tostada',25,65],
  ['Frutas','Cereza',100,25],
  ['Frutas','Chirimoya',50,35],
  ['Frutas','Ciruela',100,35],
  ['Frutas','Coco fresco',200,45],
  ['Frutas','Datil',15,70],
  ['Frutas','Frambuesa',150,25],
  ['Frutas','Fresones',200,25],
  ['Frutas','Granada',70,35],
  ['Frutas','Grosella',200,25],
  ['Frutas','Grosella negra',140,15],
  ['Frutas','Higos',100,35],
  ['Frutas','Kiwi',100,50],
  ['Frutas','Litchi',70,50],
  ['Frutas','Mandarina',100,30],
  ['Frutas','Mango',100,50],
  ['Frutas','Manzana',100,35],
  ['Frutas','Manazana asada',50,35],
  ['Frutas','Melocoton',100,35],
  ['Frutas','Melocoton conserva',50,35],
  ['Frutas','Melon',200,60],
  ['Frutas','Membrillo',150,35],
  ['Frutas','Membrillo dulce de',20,60],
  ['Frutas','Moras',150,25],
  ['Frutas','Naranja',100,35],
  ['Frutas','Nectarina',100,35],
  ['Frutas','Nispero',100,55],
  ['Frutas','Pera',100,30],
  ['Frutas','Papaya',125,55],
  ['Frutas','Paraguayo',100,35],
  ['Frutas','Piña',100,45],
  ['Frutas','Platano',50,50],
  ['Frutas','Sandia',200,75],
  ['Frutas','Uva',50,45],

  ['Hortalizas','Acelga',300,15],
  ['Hortalizas','Ajo',40,30],
  ['Hortalizas','Alcachofa',300,20],
  ['Hortalizas','Apio',300,15],
  ['Hortalizas','Berenjena',300,20],
  ['Hortalizas','Brocoli',300,15],
  ['Hortalizas','Calabacin',300,15],
  ['Hortalizas','Cebolla',150,15],
  ['Hortalizas','Coliflor',300,15],
  ['Hortalizas','Endibia',300,15],
  ['Hortalizas','Judia verde',250,30],
  ['Hortalizas','Lechuga',300,15],
  ['Hortalizas','Nabo',300,15],
  ['Hortalizas','Palmitos',200,20],
  ['Hortalizas','Pepino',300,15],
  ['Hortalizas','Pimiento',300,15],
  ['Hortalizas','Puerro',300,15],
  ['Hortalizas','Rabano',300,15],
  ['Hortalizas','Remolacha',150,30],
  ['Hortalizas','Repollo',300,15],
  ['Hortalizas','Setas',300,15],
  ['Hortalizas','Tomate',300,30],
  ['Hortalizas','Zanahoria',150,30],
  ['Hortalizas','Zanahoria hervida',200,85],

  ['Frutos secos','Aceituna',250,15],
  ['Frutos secos','Albaricoque seco',15,35],
  ['Frutos secos','Almendra',150,15],
  ['Frutos secos','Avellana',150,15],
  ['Frutos secos','Cacahuete',100,15],
  ['Frutos secos','Ciruela pasa',150,15],
  ['Frutos secos','Datil seco',15,70],
  ['Frutos secos','Higo seco',15,40],
  ['Frutos secos','Nuez',300,15],
  ['Frutos secos','Piñon',300,15],
  ['Frutos secos','Pipas',80,35],
  ['Frutos secos','Pistacho',80,15],
  ['Frutos secos','Sesamo',100,35],
  ['Frutos secos','Uva pasa',15,65],

  ['Bebidas','Bebida isotonica',130,78],
  ['Bebidas','Refresco',100,70],
  ['Bebidas','Bebida de cacao',100,34],
  ['Bebidas','Bebida de soja',250,30],
  ['Bebidas','Bebida energetica',80,70],
  ['Bebidas','Bitter',100,70],
  ['Bebidas','Cava seco',250,15],
  ['Bebidas','Cerveza',250,110],
  ['Bebidas','Horchata',75,15],
  ['Bebidas','Licor de Manzana',30,65],
  ['Bebidas','Mosto',70,15],
  ['Bebidas','Sangria',100,15],
  ['Bebidas','Sidra',200,15],
  ['Bebidas','Tonica',100,70],
  ['Bebidas','Vermut',75,15],
  ['Bebidas','Vino dulce',75,15],
  ['Bebidas','Zumo comercial',100,60],

  ['Otros','Azucar blanco',10,70],
  ['Otros','Azucar moreno',10,70],
  ['Otros','Barrita energetica',20,70],
  ['Otros','Bizcocho',20,65],
  ['Otros','Bolleria',20,70],
  ['Otros','Cruasan',20,70],
  ['Otros','Cacao en polvo',12,25],
  ['Otros','Calamares a la romana',120,15],
  ['Otros','Canelones con bechamel',100,15],
  ['Otros','Caramelo',12,70],
  ['Otros','Chocolate',17,70],
  ['Otros','Chocolate negro',25,20],
  ['Otros','Churros',25,40],
  ['Otros','Crema de cacao',25,55],
  ['Otros','Crema de cacahuetes',100,40],
  ['Otros','Croquetas',50,20],
  ['Otros','Donut',23,75],
  ['Otros','Empanadilla de carne',50,20],
  ['Otros','Edulcorante',10,20],
  ['Otros','Gazpacho',150,20],
  ['Otros','Gelatina',62,30],
  ['Otros','Glucosa',10,100],
  ['Otros','Golosinas',18,70],
  ['Otros','Ketchup',50,55],
  ['Otros','Lasaña',100,40],
  ['Otros','Magdalena',25,65],
  ['Otros','Mazapan',25,60],
  ['Otros','Mermelada',20,65],
  ['Otros','Miel',13,85],
  ['Otros','Palomitas',20,85],
  ['Otros','Pizza',40,45],
  ['Otros','Surimi',100,20],
  ['Otros','Tortilla de patata',17,70],
];

$ins = $pdo->prepare("INSERT INTO foods(name,carbs_per_100g,glycemic_index,unit)
VALUES(?,?,?, 'g')
ON DUPLICATE KEY UPDATE carbs_per_100g=VALUES(carbs_per_100g), glycemic_index=VALUES(glycemic_index), unit='g'");

$ok=0;
foreach($foods as [$tipo,$nombre,$hidratos,$gi]){
  $ins->execute([$nombre,(float)$hidratos,$gi===null? null : (int)$gi]);
  $ok++;
}
echo json_encode(['ok'=>1,'rows'=>$ok], JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT),"\n";
